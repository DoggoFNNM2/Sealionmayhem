<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE DRUNKEN RECKONING</title>
    <style>
        :root { 
            --wobble: 0deg; 
            --drift-x: 0px; 
            --drift-y: 0px;
            --hue: 0deg; 
        }

        body, html {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            background: black; overflow: hidden;
        }

        /* CHROMATIC ABERRATION OVERLAY (Affects everything behind it) */
        /* We create three layers that shift slightly to mimic double vision */
        .drunk-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1; /* Below the sea lions */
            mix-blend-mode: screen;
            transition: transform 0.1s ease-out;
        }

        .red-shift { 
            background: rgba(255, 0, 0, 0.1); 
            transform: translate(var(--drift-x), var(--drift-y)) rotate(var(--wobble)); 
        }
        .blue-shift { 
            background: rgba(0, 0, 255, 0.1); 
            transform: translate(calc(var(--drift-x) * -1), calc(var(--drift-y) * -1)) rotate(calc(var(--wobble) * -1)); 
        }

        /* VIGNETTE & BLUR FOR SEASICKNESS */
        .post-processing {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            backdrop-filter: blur(4px);
            mask-image: radial-gradient(circle, transparent 30%, black 100%);
            z-index: 10;
            pointer-events: none;
        }

        canvas {
            z-index: 5; /* Sea lions sit ABOVE the chromatic mess but BELOW the blur */
            position: relative;
        }

        #start-button {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 50px; background: #ff00ea; color: white; font-weight: bold;
            font-family: 'Impact'; font-size: 3rem; z-index: 10000;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="drunk-layer red-shift"></div>
    <div class="drunk-layer blue-shift"></div>
    <div class="post-processing"></div>

    <button id="start-button">START THE BENDER</button>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.147.0/build/three.module.js';

        let scene, camera, renderer, swarm = [];
        let time = 0;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(120, window.innerWidth / window.innerHeight, 0.01, 20);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio); 
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            const texture = new THREE.TextureLoader().load('sealion.png');

            const btn = document.getElementById('start-button');
            btn.addEventListener('click', () => {
                navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local-floor'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                }).then(session => {
                    renderer.xr.setSession(session);
                    btn.style.display = 'none';
                });
            });

            // SWARM OF SEA LIONS (The only stable things in your world)
            for (let i = 0; i < 200; i++) {
                const mat = new THREE.SpriteMaterial({
                    map: texture,
                    transparent: true,
                    opacity: 0.9
                });
                const s = new THREE.Sprite(mat);
                s.position.set((Math.random()-0.5)*8, (Math.random()-0.5)*8, (Math.random()-0.5)*8);
                s.scale.set(0.3, 0.3, 1);
                scene.add(s);
                swarm.push({
                    obj: s,
                    offset: Math.random() * 100,
                    speed: 0.01 + Math.random() * 0.02
                });
            }

            renderer.setAnimationLoop((timestamp, frame) => {
                time += 0.02;

                // 1. DRUNK CSS ANIMATION (Chromatic Aberration + Rotation)
                const driftX = Math.sin(time * 0.5) * 15;
                const driftY = Math.cos(time * 0.7) * 15;
                const wobble = Math.sin(time * 0.3) * 3; // Sloshing rotation

                document.documentElement.style.setProperty('--drift-x', `${driftX}px`);
                document.documentElement.style.setProperty('--drift-y', `${driftY}px`);
                document.documentElement.style.setProperty('--wobble', `${wobble}deg`);

                // 2. CAMERA SEASICKNESS (The inner ear failure)
                camera.position.y = Math.sin(time * 0.5) * 0.2; 
                camera.rotation.z = Math.sin(time * 0.4) * 0.15; // Horizon tilt
                camera.fov = 100 + Math.sin(time * 0.2) * 20; // Pushing/Pulling vision
                camera.updateProjectionMatrix();

                // 3. SEA LION MOVEMENT (Swimming through the chaos)
                swarm.forEach((s) => {
                    s.obj.position.y += Math.sin(time + s.offset) * 0.005;
                    s.obj.material.rotation = Math.sin(time + s.offset) * 0.1;
                });

                renderer.render(scene, camera);
            });
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
