<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE FINAL MILK RECKONING</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background: transparent; overflow: hidden; }
        
        /* This creates a "Double Vision" ghosting layer over everything */
        #ui-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
            border: 20px solid rgba(255, 0, 0, 0.2);
            box-sizing: border-box;
            mix-blend-mode: color-burn; /* Makes reality look "bruised" */
            animation: pulse-red 0.5s infinite alternate;
        }

        @keyframes pulse-red {
            from { background: rgba(255, 0, 255, 0.05); }
            to { background: rgba(0, 255, 255, 0.05); }
        }

        #start-button { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 40px; background: white; color: black; font-weight: bold;
            font-family: 'Impact'; font-size: 2.5rem; z-index: 10001; cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="ui-overlay"></div>
    <button id="start-button">DRINK THE FINAL GLASS</button>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.147.0/build/three.module.js';

        let scene, camera, renderer, swarm = [];
        let time = 0;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(120, window.innerWidth / window.innerHeight, 0.01, 20);
            
            renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
            renderer.setPixelRatio(0.3); 
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            const texture = new THREE.TextureLoader().load('sealion.png');

            const btn = document.getElementById('start-button');
            btn.addEventListener('click', () => {
                navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local-floor'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                }).then(session => {
                    renderer.xr.setSession(session);
                    btn.style.display = 'none';
                });
            });

            // SWARM OF 300 MINI SEA LIONS - Constant Rotation
            for (let i = 0; i < 300; i++) {
                const mat = new THREE.SpriteMaterial({ 
                    map: texture, 
                    color: new THREE.Color(`hsl(${Math.random() * 360}, 100%, 50%)`),
                    transparent: true,
                    opacity: 0.8
                });
                const s = new THREE.Sprite(mat);
                s.position.set((Math.random()-0.5)*8, (Math.random()-0.5)*8, (Math.random()-0.5)*8);
                s.scale.set(0.1, 0.1, 1);
                scene.add(s);
                swarm.push({
                    obj: s,
                    rotSpeed: (Math.random() - 0.5) * 0.5,
                    phase: Math.random() * 10
                });
            }

            renderer.setAnimationLoop((timestamp, frame) => {
                time += 0.04;

                if (frame) {
                    // SEVERE DIZZINESS: The camera won't stop rolling
                    camera.rotation.z = Math.sin(time * 0.5) * 0.5; 
                    camera.rotation.x = Math.cos(time * 0.3) * 0.2;
                    
                    // WOBBLE: The world drifts back and forth
                    camera.position.x = Math.sin(time) * 0.5;
                    
                    // VISION PULSE: Rapid zooming
                    camera.fov = 100 + Math.sin(time * 10) * 20;
                    camera.updateProjectionMatrix();
                }

                swarm.forEach((s, i) => {
                    s.obj.material.rotation += s.rotSpeed;
                    // Drunken "swimming" logic
                    s.obj.position.y += Math.sin(time + s.phase) * 0.02;
                    s.obj.position.x += Math.cos(time + s.phase) * 0.02;
                    
                    // Make them flicker in and out of existence
                    s.obj.material.opacity = 0.3 + Math.sin(time * 5 + i) * 0.5;
                });

                renderer.render(scene, camera);
            });
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
