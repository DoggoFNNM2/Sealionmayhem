<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEA LION MILK FEVER</title>
    <style>
        :root { 
            --wobble: 0deg; 
            --drift-x: 0px; 
            --drift-y: 0px;
        }

        body, html {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            background: black; overflow: hidden;
        }

        /* CHROMATIC ABERRATION LAYERS */
        .drunk-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1; mix-blend-mode: screen;
        }

        .red-shift { 
            background: rgba(255, 0, 0, 0.15); 
            transform: translate(var(--drift-x), var(--drift-y)) rotate(var(--wobble)); 
        }
        .blue-shift { 
            background: rgba(0, 255, 255, 0.15); 
            transform: translate(calc(var(--drift-x) * -1.5), calc(var(--drift-y) * -1.5)) rotate(calc(var(--wobble) * -1.2)); 
        }

        .post-processing {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            backdrop-filter: blur(3px) contrast(1.5) saturate(2);
            mask-image: radial-gradient(circle, transparent 20%, black 90%);
            z-index: 10; pointer-events: none;
        }

        canvas { z-index: 5; position: relative; }

        #start-button {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 40px; background: #00ffcc; color: black; font-weight: bold;
            font-family: 'Comic Sans MS', 'Impact'; font-size: 2rem; z-index: 10000;
            border: 10px dotted white; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="drunk-layer red-shift"></div>
    <div class="drunk-layer blue-shift"></div>
    <div class="post-processing"></div>

    <button id="start-button">CHUG THE MILK</button>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.147.0/build/three.module.js';

        let scene, camera, renderer, swarm = [], hallucinations = [], floor;
        let time = 0;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(120, window.innerWidth / window.innerHeight, 0.01, 50);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            const texture = new THREE.TextureLoader().load('sealion.png');

            // 1. THE WOBBLY FLOOR
            const floorGeo = new THREE.PlaneGeometry(20, 20, 32, 32);
            const floorMat = new THREE.MeshBasicMaterial({ 
                map: texture, 
                side: THREE.DoubleSide, 
                transparent: true, 
                opacity: 0.7,
                color: 0x00ff00 
            });
            floor = new THREE.Mesh(floorGeo, floorMat);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -2;
            scene.add(floor);

            // 2. THE HALLUCINATIONS (3D Objects)
            const geometries = [
                new THREE.TorusKnotGeometry(0.5, 0.2, 100, 16),
                new THREE.IcosahedronGeometry(0.5, 0),
                new THREE.OctahedronGeometry(0.5, 0)
            ];

            for (let i = 0; i < 40; i++) {
                const geo = geometries[Math.floor(Math.random() * geometries.length)];
                const mat = new THREE.MeshNormalMaterial({ wireframe: Math.random() > 0.5 });
                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set((Math.random()-0.5)*15, (Math.random()-0.5)*15, (Math.random()-0.5)*15);
                scene.add(mesh);
                hallucinations.push({
                    obj: mesh,
                    rot: new THREE.Vector3(Math.random()*0.05, Math.random()*0.05, Math.random()*0.05)
                });
            }

            // 3. THE SEA LION SWARM
            for (let i = 0; i < 150; i++) {
                const mat = new THREE.SpriteMaterial({ map: texture, transparent: true, opacity: 0.8 });
                const s = new THREE.Sprite(mat);
                s.position.set((Math.random()-0.5)*10, (Math.random()-0.5)*10, (Math.random()-0.5)*10);
                s.scale.set(0.4, 0.4, 1);
                scene.add(s);
                swarm.push({ obj: s, phase: Math.random() * Math.PI * 2 });
            }

            const btn = document.getElementById('start-button');
            btn.addEventListener('click', () => {
                navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local-floor'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                }).then(session => {
                    renderer.xr.setSession(session);
                    btn.style.display = 'none';
                });
            });

            renderer.setAnimationLoop((timestamp, frame) => {
                time += 0.03;

                // CSS Drunk Effects
                document.documentElement.style.setProperty('--drift-x', `${Math.sin(time) * 20}px`);
                document.documentElement.style.setProperty('--drift-y', `${Math.cos(time * 0.8) * 20}px`);
                document.documentElement.style.setProperty('--wobble', `${Math.sin(time * 0.5) * 5}deg`);

                // Floor Wobble (Vertex displacement logic)
                const pos = floor.geometry.attributes.position;
                for (let i = 0; i < pos.count; i++) {
                    const x = pos.getX(i);
                    const y = pos.getY(i);
                    const z = Math.sin(x * 0.5 + time) * Math.cos(y * 0.5 + time) * 0.5;
                    pos.setZ(i, z);
                }
                pos.needsUpdate = true;

                // Hallucination Spinning
                hallucinations.forEach(h => {
                    h.obj.rotation.x += h.rot.x;
                    h.obj.rotation.y += h.rot.y;
                    h.obj.position.y += Math.sin(time + h.obj.position.x) * 0.01;
                });

                // Seasickness Camera
                camera.position.x = Math.sin(time * 0.4) * 0.5;
                camera.rotation.z = Math.sin(time * 0.3) * 0.1;
                camera.fov = 100 + Math.sin(time * 0.5) * 25;
                camera.updateProjectionMatrix();

                renderer.render(scene, camera);
            });
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
